(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();function u(e){const t=document.getElementById("loading");t.style.display=e?"block":"none"}async function h(e,t){const n=await fetch(t,{method:"POST",body:e});if(!n.ok)throw new Error("Server error: "+n.status);return n.json()}const y=e=>{const t=document.createElement("div");t.className="card-layout";const n=document.createElement("img");n.id="cardImage",n.src=e.pngLink,n.alt=e.cardName;const a=document.createElement("div");return a.id="cardInfo",a.innerHTML=`
    <h2>${e.cardName}</h2>
    <p><strong>Rarity:</strong> ${e.rarity}</p>
    <p><strong>Collector #:</strong> ${e.collectorNumber}</p>
    <p><strong>Price (Normal):</strong> $${e.priceNormal??"N/A"}</p>
    <p><strong>Price (Foil):</strong> $${e.priceFoil??"N/A"}</p>
  `,t.appendChild(n),t.appendChild(a),t},E=(e,t,n)=>{const a=document.createElement("div");a.className="alt-matches";const o=document.createElement("h3");return o.textContent="Other closely matching cards:",a.appendChild(o),e.forEach(r=>{const c=document.createElement("button");c.textContent=`${r.cardName} (${r.cardSet})`,c.onclick=()=>{const i=e.filter(l=>l.collectorNumber!==r.collectorNumber).concat(t);f(n,{bestMatch:r,otherMatches:i})},a.appendChild(c)}),a};function f(e,t){const{bestMatch:n,otherMatches:a=[]}=t;e.innerHTML="",e.appendChild(y(n)),a.length&&e.appendChild(E(a,n,e))}async function C(e,t=2048,n=.9){return new Promise((a,o)=>{const r=new Image;r.src=URL.createObjectURL(e),r.onload=()=>{let{width:c,height:i}=r;if(Math.max(c,i)>t){const s=t/Math.max(c,i);c=Math.round(c*s),i=Math.round(i*s)}const l=document.createElement("canvas");l.width=c,l.height=i,l.getContext("2d").drawImage(r,0,0,c,i),l.toBlob(s=>{s||o("Compression failed"),a(new File([s],e.name.replace(/\.\w+$/,".jpg"),{type:"image/jpeg"}))},"image/jpeg",n)},r.onerror=o})}const w="https://mtgrecognizer.dpdns.org/card_data";async function L(e){e.preventDefault();const t=document.getElementById("file"),n=document.getElementById("result");if(!t.files.length)return;const a=t.files[0],o=await C(a,2048,.9);console.log("successfully compressed");const r=new FormData;r.append("file",o);try{u(!0),n.textContent="";const c=await h(r,w);f(n,c)}catch(c){n.textContent="Upload failed: "+c.message}finally{u(!1)}}function N(){const e=document.createElement("header");e.className="app-header";const t=document.createElement("img");t.src=new URL("/MtgRecognizer/assets/logo.png",import.meta.url).href,t.alt="Magic the Gathering",t.className="app-logo";const n=document.createElement("div");n.className="app-title";const a=document.createElement("h1");a.textContent="Magic the Gathering Card Recognizer";const o=document.createElement("p");return o.textContent="Upload a card image to identify and price it",n.appendChild(a),n.appendChild(o),e.appendChild(t),e.appendChild(n),e}const d=document.querySelector("#app");d.innerHTML="";d.appendChild(N());const p=document.createElement("form");p.id="upload";p.innerHTML=`
  <label for="file">File to upload</label>
  <input type="file" id="file" accept="image/*">
  <button type="submit">Upload</button>
`;d.appendChild(p);const m=document.createElement("div");m.id="loading";m.className="spinner";m.style.display="none";d.appendChild(m);const g=document.createElement("div");g.id="result";d.appendChild(g);p.addEventListener("submit",L);
