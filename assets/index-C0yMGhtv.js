(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();function d(e){const t=document.getElementById("loading");t.style.display=e?"block":"none"}async function g(e,t){const n=await fetch(t,{method:"POST",body:e});if(!n.ok)throw new Error("Server error: "+n.status);return n.json()}const h=e=>{const t=document.createElement("div");t.className="card-layout";const n=document.createElement("img");n.id="cardImage",n.src=e.pngLink,n.alt=e.cardName;const a=document.createElement("div");return a.id="cardInfo",a.innerHTML=`
    <h2>${e.cardName}</h2>
    <p><strong>Rarity:</strong> ${e.rarity}</p>
    <p><strong>Collector #:</strong> ${e.collectorNumber}</p>
    <p><strong>Price (Normal):</strong> $${e.priceNormal??"N/A"}</p>
    <p><strong>Price (Foil):</strong> $${e.priceFoil??"N/A"}</p>
  `,t.appendChild(n),t.appendChild(a),t},y=(e,t,n)=>{const a=document.createElement("div");a.className="alt-matches";const o=document.createElement("h3");return o.textContent="Other closely matching cards:",a.appendChild(o),e.forEach(r=>{const c=document.createElement("button");c.textContent=`${r.cardName} (${r.cardSet})`,c.onclick=()=>{const u=e.filter(f=>f.collectorNumber!==r.collectorNumber).concat(t);p(n,{bestMatch:r,otherMatches:u})},a.appendChild(c)}),a};function p(e,t){const{bestMatch:n,otherMatches:a=[]}=t;e.innerHTML="",e.appendChild(h(n)),a.length&&e.appendChild(y(a,n,e))}const E="http://mtgrecognizer.dpdns.org/card_data";async function C(e){e.preventDefault();const t=document.getElementById("file"),n=document.getElementById("result");if(!t.files.length)return;const a=t.files[0],o=new FormData;o.append("file",a);try{d(!0),n.textContent="";const r=await g(o,E);console.log(r),p(n,r)}catch(r){n.textContent="Upload failed: "+r.message}finally{d(!1)}}function N(){const e=document.createElement("header");e.className="app-header";const t=document.createElement("img");t.src=new URL("/MtgRecognizer/assets/logo.png",import.meta.url).href,t.alt="Magic the Gathering",t.className="app-logo";const n=document.createElement("div");n.className="app-title";const a=document.createElement("h1");a.textContent="Magic the Gathering Card Recognizer";const o=document.createElement("p");return o.textContent="Upload a card image to identify and price it",n.appendChild(a),n.appendChild(o),e.appendChild(t),e.appendChild(n),e}const i=document.querySelector("#app");i.innerHTML="";i.appendChild(N());const l=document.createElement("form");l.id="upload";l.innerHTML=`
  <label for="file">File to upload</label>
  <input type="file" id="file" accept="image/*">
  <button type="submit">Upload</button>
`;i.appendChild(l);const s=document.createElement("div");s.id="loading";s.className="spinner";s.style.display="none";i.appendChild(s);const m=document.createElement("div");m.id="result";i.appendChild(m);l.addEventListener("submit",C);
